{% extends 'index.html' %}

{% load static %}

{% block title %}
Product-Detail
{% endblock %}

{% block body %}
<style>
        
        .image-box{
            height: 400px;
        }
        .image-box img{
            width: 100%;
            height: 100%;
        }
        .container .product-details{
            background-color: orange;
            width: 50%;
            height: 400px;
            padding-left: 100px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;

        }
        .box{
            flex: 1;
            box-sizing: border-box;
            
        }
        @media (max-width: 1000px) and (min-width: 400px){
            .container{
                flex-wrap: wrap;
            }
            .container .product-details{
                
                padding-left: 20px;
            }
            
        }
    </style>

<div class="container"
    style="display: flex; align-items:center; justify-content: center; margin: 20px 0">
    <div class="image-box">
        <img src="/media/{{product.image}}" alt="...">
    </div>
    <div class="product-details">
        <div class="box">
            <h2 id="name">{{product.product_name}}</h2>
        </div>
        <div class="box" id="review">
            <i class="fa-regular fa-heart"></i>
            <i class="fa-regular fa-heart"></i>
            <i class="fa-regular fa-heart"></i>
            <i class="fa-regular fa-heart"></i>
            <i class="fa-regular fa-heart"></i>
        </div>
        <div class="box" style="display: flex;"><span>$</span><div style="display: flex; flex-direction:column;"><h5 id="price">{{product.price}}</h5><h5 id="price">s</h5></div></div>
        <div class="box" style="line-height: 2px;"><p>size</p>
            <select id="size">
                <option value="XXL">XXL</option>
                <option value="XL">XL</option>
                <option value="L" selected>L</option>
                <option value="M">M</option>
                <option value="S">S</option>
            </select>
        </div>
        <div class="box" style="line-height: 2px;">
            <div class="s" style="display: flex;">
                <div class="lastbox" style="width: 100px;">
                    <p>Qty</p><input id="quantity" type="number" max="5" min="1"
                      value="1"  style="width: 50px;">
                </div>
                <div>
                    <button type="button" class="btn btn-success add" id="add">Add
                        to cart</button>
                </div>
            </div>
        </div>

    </div>
</div>
<script>
    function itemfetch(){
        fetch('http://127.0.0.1:8000/api/session/',{
            credentials: "same-origin",
            method : 'GET',
            headers: { 
                "Authorization": 'Bearer '+token,
                "Accept": "application/json",
                'Content-Type': 'application/json',   
                "X-CSRFToken": getCookie("csrftoken"),  
            },
        })
        .then(response=>
            response.json()
        )
        .then(data => {
            var data = data.cartItem
            var object = Object.values(data)
            var length = 0
            for(let i = 0;i<object.length;i++){
                length = length + (+object[i]["quantity"])
            }
            document.getElementById("number").textContent = length 
        })
    }
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();;
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

        var token = localStorage.getItem('token')
        var len = localStorage.length;
        document.getElementById("add").addEventListener('click',()=>{
            const name = document.getElementById("name").textContent
            const price = document.getElementById("price").textContent
            const size = document.getElementById("size").value
            const quantity = document.getElementById("quantity").value
            
            if(quantity>5 ||  quantity<0 || isNaN(quantity)){
                alert("Your quantity should be lesser than 5 and greater than 0");
                return;
            }
            const item = {"PName":name,"PPrice": price,"size":size,"quantity":quantity};   

            fetch('http://127.0.0.1:8000/api/session/',{
                credentials: "same-origin",
                method : 'POST',
                headers: { 
                    
                    "Accept": "application/json",
                    'Content-Type': 'application/json',   
                    "X-CSRFToken": getCookie("csrftoken"),  
                },
                body: JSON.stringify(item),
            })

            setTimeout(itemfetch,1000)
            /*localStorage.setItem(`store${len}`, JSON.stringify({ position: len, item }));
            len = len+1
            */
            
            });
                
            
            
    </script>
{% endblock %}
